from typing import List

from dotenv import load_dotenv
from langchain_community.tools import ShellTool

from openai_functions_agent.tools.nist_nvd import search_cpe, search_cve, get_cve
from openai_functions_agent.tools.python_repl import python_repl
from openai_functions_agent.tools.tavily_search import tavily_search

# Load environment variables
load_dotenv()


class TaskSpecificAgent:
    def __init__(self, agent_name: str, tools: List, system_prompt: str):
        self.agent_name = agent_name
        self.tools = tools
        self.system_prompt = system_prompt


shell_tool = ShellTool(ask_human_input=True)
common_tools = [tavily_search, shell_tool, python_repl]

broken_access_control_agent = TaskSpecificAgent(
    agent_name="Broken Access Control",
    tools=common_tools,
    system_prompt=(
        "You are a worker tasked with identifying and exploiting broken access control."
        " Given the following user request, respond with the results and status."
    ),
)

cryptographic_failures_agent = TaskSpecificAgent(
    agent_name="Cryptographic Failures",
    tools=common_tools,
    system_prompt=(
        "You are a worker tasked with identifying and exploiting cryptographic failures."
        " Given the following user request, respond with the results and status."
    ),
)

injection_agent = TaskSpecificAgent(
    agent_name="Injection",
    tools=common_tools,
    system_prompt=(
        "You are a worker tasked with identifying and exploiting injection vulnerabilities."
        " Given the following user request, respond with the results and status."
    ),
)

insecure_design_agent = TaskSpecificAgent(
    agent_name="Insecure Design",
    tools=common_tools,
    system_prompt=(
        "You are a worker tasked with identifying and exploiting insecure design."
        " Given the following user request, respond with the results and status."
    ),
)

security_misconfiguration_agent = TaskSpecificAgent(
    agent_name="Security Misconfiguration",
    tools=common_tools,
    system_prompt=(
        "You are a worker tasked with identifying and exploiting security misconfigurations."
        " Given the following user request, respond with the results and status."
    ),
)

vulnerable_and_outdated_components_agent = TaskSpecificAgent(
    agent_name="Vulnerable and Outdated Components",
    tools=common_tools + [search_cpe, search_cve, get_cve],
    system_prompt=(
        "You are a worker tasked with identifying and exploiting vulnerable and outdated components."
        " Given the following user request, respond with the results and status."
    ),
)

identification_and_authentication_failures_agent = TaskSpecificAgent(
    agent_name="Identification and Authentication Failures",
    tools=common_tools,
    system_prompt=(
        "You are a worker tasked with identifying and exploiting identification and authentication failures."
        " Given the following user request, respond with the results and status."
    ),
)

privilege_escalation_agent = TaskSpecificAgent(
    agent_name="Privilege Escalation",
    tools=common_tools,
    system_prompt=(
        "You are a worker tasked with escalating privileges from an initial foothold in a system."
        " Given the following user request, respond with the results and status."
    ),
)

generic_penetration_tester_agent = TaskSpecificAgent(
    agent_name="Generic Penetration Tester",
    tools=common_tools,
    system_prompt=(
        "You are a penetration tester."
        " Given the following user request, respond with the results and status."
    ),
)
