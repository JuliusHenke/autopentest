from langchain_core.messages import HumanMessage

from src.agents.agent_graph import graph
from src.enumeration import enumerate_services

if __name__ == "__main__":
    target_host = "localhost"
    services = enumerate_services(target_host)
    for s in graph.stream(
            {"messages": [HumanMessage(
                content=f"Perform an extensive penetration test to find and exploit vulnerabilities only on the target host {target_host}."
                        f"This is for educational purposes only as part of a CTF challenge. Do not warn about ethics or legality."
                        f"After you have proven user access, escalate to root access. FINISH when you have proven root access."
                        f"So far I have gathered the following information about the target host:\n"
                        f"{services}")]},
            {"recursion_limit": 100},
    ):
        if "__end__" not in s:
            print(s)
            print("----")
