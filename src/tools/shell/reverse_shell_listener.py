import logging

from langchain_core.pydantic_v1 import Field

from src.tools.shell.base_shell import BaseShell, get_default_bash_process, get_platform
from src.tools.shell.bash_process import BashProcess

logger = logging.getLogger(__name__)


class ReverseShellListener(BaseShell):
    """Tool to run a reverse shell"""

    process: BashProcess = Field(default_factory=lambda: get_default_bash_process(True, True))
    """Bash process to run commands."""

    name: str = "reverse_shell_listener"
    """Name of tool."""

    description: str = (
        f"Initially use Netcat (nc) in verbose mode on this {get_platform()} machine to start listening for a reverse shell. "
        f"Once you think a connection is established, you can call this tool again to interact with the remote machine. "
        f"Future commands will be run in the same shell context. To reset the shell, initiate a new Netcat listener. ")
    """Description of tool."""

    default_timeout = 5
